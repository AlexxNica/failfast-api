# Generated from .gitlab-ci.jsonnet 
#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN 
---
build_image:
  before_script:
  - docker info
  - docker login -u failfast-ci+gitlabci -p $QUAY_TOKEN quay.io
  image: docker:git
  only:
  - master
  - tags
  script:
  - 'docker build  --no-cache -t quay.io/failfast-ci/failfast:${CI_COMMIT_REF_SLUG}-${SHA8} . '
  - docker push quay.io/failfast-ci/failfast:${CI_COMMIT_REF_SLUG}-${SHA8}
  services:
  - docker:dind
  stage: build_image
  tags:
  - kubernetes
  variables:
    DOCKER_DRIVER: overlay2
    DOCKER_HOST: tcp://localhost:2375
build_image_branche:
  before_script:
  - docker info
  - docker login -u failfast-ci+gitlabci -p $QUAY_TOKEN quay.io
  except:
  - master
  - tags
  image: docker:git
  only:
  - branches
  script:
  - 'docker build  --no-cache -t quay.io/failfast-ci/failfast:${CI_COMMIT_REF_SLUG}-${SHA8} . '
  - docker push quay.io/failfast-ci/failfast:${CI_COMMIT_REF_SLUG}-${SHA8}
  services:
  - docker:dind
  stage: build_image
  tags:
  - kubernetes
  variables:
    DOCKER_DRIVER: overlay2
    DOCKER_HOST: tcp://localhost:2375
  when: manual
cache:
  paths:
  - cache
stages:
- build_image
variables:
  FAILFASTCI_NAMESPACE: failfast-ci
